<script>
	function markForRunningCrea() {
		projectProgression = document.getElementById('projectProgression');
		if (projectProgression.value == 'todocrea') {
			projectProgression.value = 'runningcrea';
		}
	}
	function changeProgression() {
		projectType = document.getElementById('projectType');
		if (projectType.value == 'print' || projectType.value == 'creaprint' || projectType.value == 'printother') {
			document.getElementById('projectProgression').value = 'todoprint';
		}		
	}
	function revealePrint() {
		var printTab = document.getElementById('printref');
		document.getElementById('printli').className="";
		printTab.setAttribute('aria-controls', 'print');
		printTab.setAttribute('role', 'tab');
		printTab.setAttribute('data-toggle', 'tab');
		printTab.innerHTML += 'Print';
	}
	function hidePrint() {
		var printTab = document.getElementById('printref');
		document.getElementById('printli').className="disabled";
		printTab.setAttribute('aria-controls', '');
		printTab.setAttribute('role', '');
		printTab.setAttribute('data-toggle', '');
		printTab.innerHTML = '';
	}
</script>
<%= form_for(@project, :html => {class: ".form-inline"}) do |f|%>
<div class="row clearfix">
	<div class="col-md-6">
		<div class="panel panel-default">
			<div class='panel-heading'>
				<strong>Informations générales:</strong>
			</div>
			<div class='panel-body'>
				<table class="table table-striped table-bordered">
					<tr>
						<td> <%= f.label :nom %> </td>
						<td> <%= f.text_field :name, class: 'form-control'%> </td>
					</tr>
					<tr>
						<td> <%= f.label :numero %> </td>
						<td> <%= f.number_field :number, class: 'form-control'%> </td>
					</tr>
					<tr>
						<td> <%= f.label :assigné %> </td>
						<td> <%= collection_select(:project, :worker_id, User.all, :id, :login, {prompt: 'Sélectionner un utilisateur'}, {class: 'form-control'})%> </td>
					</tr>
					<tr>
						<td> <%= f.label :type_de_projet %> </td>
						<td> <%= f.select(:project_type, options_for_select(t("project_types").invert, @project.project_type), {:include_blank => 'Selectionner un type de projet'}, class: 'form-control', id: 'projectType', onchange: 'if (this.selectedIndex == 1 || this.selectedIndex == 3 || this.selectedIndex == 6) { revealePrint();} else {hidePrint();}')%> </td>
					</tr>
					<tr>
						<td> <%= f.label :description %> </td>
						<td> <%= f.text_area :description, class: 'form-control' %> </td>
					</tr>
					<tr>
						<td> <%= f.label :priorite %>
						<br>
						</td>
						<td> <%= f.select(:priority, options_for_select(t("project_priorities").invert, @project.priority), {:include_blank => 'Selectionner une priorité'}, {class: 'form-control'})%> </td>
					</tr>
					<% if current_user.manager?%>
					<tr>
						<td> <%= f.label :archiver%> </td>
						<td> <%= f.check_box :archived%> </td>
					</tr>
					<% end %>
					<tr>
						<td> <%= f.label :statut %>
						<br>
						</td>
						<td> <%= f.select(:state, options_for_select(t("project_status").invert, @project.state), {:include_blank => 'Selectionner une priorité'},{class: 'form-control'})%> </td>
					</tr>
					<tr>
						<td> <%= f.label :progression%> </td>
						<td> <%= f.select(:progression, options_for_select(t("project_progression").invert, @project.progression), {:include_blank => 'Sélectionner un avancement du projet'}, class: 'form-control', id: 'projectProgression', onchange: 'if (this.selectedIndex == 3) { changeProgression();}')%> </td>
					</tr>
					<tr>
						<td> <%= f.label :important %>
						<br>
						</td>
						<td> <%= f.text_area :important, class: 'form-control'%> </td>
					</tr>
				</table>
			</div>
			<div class="panel-heading">
				<strong>Client:</strong>
			</div>
			<div class="panel-body">
				<%= f.fields_for :participants do |p| %>
				<% render 'projects/forms/participant_fields', :f => p %>
				<% end %>
				<p class="text-left">
					<%= link_to_add_association '<span class="glyphicon glyphicon-plus"></span>'.html_safe, f, :participants, class: "btn btn-success", :partial => '/projects/forms/participant_fields' %>
				</p>
			</div>
		</div>
	</div>
	<div class="col-md-6">
		<div class="panel panel-warning">
			<div class='panel-heading'>
				<strong>Dates clés</strong>
			</div>
			<div class='panel-body'>
				<table class="table table-striped table-bordered">
					<tr>
						<td> <%= f.label :date_de_premier_retour%> </td>
						<td> <%= f.date_field :first_feedback, class: 'form-control'%> </td>
					</tr>
					<tr>
						<td> <%= f.label :bon_a_tirer%> </td>
						<td> <%= f.date_field :good_to_print, class: 'form-control'%> </td>
					</tr>
					<tr>
						<td> <%= f.label :date_de_depart%> </td>
						<td> <%= f.date_field :departure_date, class: 'form-control'%> </td>
					</tr>
					<tr>
						<td> <%= f.label :date_de_livraison%> </td>
						<td> <%= f.date_field :delivery_date, class: 'form-control'%> </td>
					</tr>
				</table>
			</div>
		</div>
	</div>
	<div class="col-md-6">
		<div class="panel panel-success">
			<div class="panel-heading">
				Données chiffrées:
			</div>
			<div class="panel-body">
				<table class="table table-bordered table-striped">
					<tr>
						<td> <%= f.label :temps_estimé %>
						<br>
						</td>
						<td> <%= f.text_field :hours, class: 'form-control' %>Heures <%= f.text_field :minutes, class: 'form-control'%>Minutes </td>
					</tr>
					<tr>
						<td> <%= f.label :nombre_de_retour_prévus %>
						<br>
						</td>
						<td> <%= f.number_field :feedback_number, class: 'form-control'%> </td>
					</tr>
				</table>
			</div>
		</div>
	</div>
</div>
<div>

<% if (@project.new_record?)%>
  <!-- Nav tabs -->
  <ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active"><a href="#studio" aria-controls="studio" role="tab" data-toggle="tab">Studio</a></li>
    <li role="presentation" class="" id="printli"><a href="#print" id="printref"></a></li>
  </ul>
  <div class="tab-content">
	<div role="tabpanel" class="tab-pane active" id="studio">
  		<%= render 'projects/forms/studio_fields', :f => f%>
	</div>
	<div role="tabpanel" class="tab-pane" id="print">
	  	<%= render 'projects/forms/print_fields', :f => f %>
	 </div>
  </div>
<% else %>
	<ul class="nav nav-tabs" role="tablist">
		<li role="presentation" class="<%= current_user.print? ? '' : 'active'%>">
			<a href="#studio" aria-controls="studio" role="tab" data-toggle="tab">Studio</a>
		</li>
		<% if @project.project_type == 'print' || @project.project_type == 'creaprint' || @project.project_type == 'printother'%>
		<li role="presentation" class="<%= current_user.print? ? 'active' : ''%>">
			<a href="#print" aria-controls="print" role="tab" data-toggle="tab">Print</a>
		</li>
		<% else %>
	    <li role="presentation" class="" id="printli"><a href="#print" id="printref"></a></li>
		<% end %>
	</ul>
  
  	<div class="tab-content">
		<div role="tabpanel" class="tab-pane <%= current_user.print? ? '' : 'active' %>" id="studio">
	    	<%= render 'projects/forms/studio_fields', :f => f %>
    	</div>
		<% if @project.project_type == 'print' || @project.project_type == 'creaprint' || @project.project_type == 'printother'%>
		<div role="tabpanel" class="tab-pane <%= current_user.print? ? 'active' : ''%>" id="print">
			<%= render 'projects/forms/print_fields', :f => f %>
		</div>
		<% else %>
		<div role="tabpanel" class="tab-pane" id="print">
		  	<%= render 'projects/forms/print_fields', :f => f %>
		 </div>
		<% end %>
	</div>
<% end%>
  <!-- Tab panes -->

</div>
<p class="text-center">
	<%= link_to 'Back', projects_path, class: 'btn btn-default'%>
	<%= f.submit 'Valider', class: 'btn btn-danger'%>
</p>
<% end %>
