<script>
	$(function() {
		$('[data-toggle="tooltip"]').tooltip()
	})
</script>
<p>
	<%= link_to 'Nouveau Projet', new_project_path, class: 'btn btn-default'%>
</p>
<div class="clearfix">
	<div class="panel panel-default">
		<div class="panel body">
			Filtres :
			<%= form_tag(projects_path, :method => "get", id: "search-form") do %>
			<div class="col-md-2">
				<div class="form-group">
					<label for="name">Nom</label>
					<%= text_field_tag :name, params[:name], placeholder: "Nom du projet", class: 'form-control' %>
				</div>
			</div>
			<div class="col-md-2">
				<div class="form-group">
					<label for="number">Numéro</label>
					<%= text_field_tag :number, params[:number], placeholder: "Numéro du projet", class: 'form-control' %>
				</div>
			</div>
			<div class="col-md-2">
				<div class="form-group">
					<label for="user_id">Personne assignée</label>
					<select name="user_id" class="form-control">
						<option value>Sélectionner un utilisateur</option>
						<option value="all">Tous</option>
						<% @users = User.all%>
						<%= @users.each do |user| %>
						<option value="<%= user.id %>" <%= params[:user_id].to_i == user.id ? 'selected' : ''%>><%= user.login %></option>
						<% end %>
					</select>
				</div>
			</div>
			<div class="col-md-2">
				<div class="form-group">
					<label for="client_id">Client</label>
					<select name="client_id" class="form-control">
						<option value>Sélectionner un client</option>
						<% @clients.each do |client| %>
						<option value="<%= client.id%>" <%= params[:client_id].to_i == client.id ? 'selected' : ''%>><%= client.name%></option>
						<% end %>
					</select>
				</div>
			</div>
			<div class="col-md-2">
				<div class="form-group">
					<label for="project_type">Type de projet</label>
					<select name="project_type" class="form-control">
						<option value>Sélectionner un type de projet</option>
						<% Project.project_types.each do |project_type| %>
						<option value="<%= project_type[1]%>" <%= project_type[1] == params[:project_type].to_i ? 'selected' : ''%>><%= t project_type[0]%></option>
						<% end %>
					</select>
				</div>
			</div>
			<div class="col-md-2">
				<div class="form-group">
					<label for="number">Date de création</label>
					<%= date_field_tag :create_date, params[:create_date], placeholder: "Numéro du projet", class: 'form-control' %>
				</div>
			</div>
			<div class="col-md-2">
				<div class="form-group">
					<label for="archived">Projet archivé</label>
					<%= check_box_tag :archived, true, params[:archived], placeholder: 'Archivé'%>
				</div>
			</div>
			<div class="form-group">
				<%= submit_tag "Search", class: 'btn btn-success' %>
			</div>
			<% end %>
		</div>
	</div>
</div>
<div class="panel panel-default">
	<div class="panel-heading">
		<strong>Liste des Projets</strong>
	</div>
	<div class="panel-body">
		<table class="table table-bordered text-center table-hover table-striped">
			<thead>
				<% if (!current_user.print?)%>
				<tr>
					<th>#</th>
					<th>Créé le</th>
					<th>Client</th>
					<th>Nom du projet</th>
					<th>Type de projet</th>
					<th>Priorité</th>
					<th>Asssigné à</th>
					<th>Temps réel / estimé</th>
					<th>Dates</th>
					<th>Retours</th>
					<th>Statut</th>
				</tr>
				<% else%>
				<tr>
					<th>#</th>
					<th>Client</th>
					<th>Nom du projet</th>
					<th>Type de projet</th>
					<th>Priorité</th>
					<th>Dates</th>
					<th>Statut</th>
					<th>BAT</th>
					<th>Remarques</th>
					<th>Sous-traitance</th>
				</tr>
				<% end %>
			</thead>
			<tbody>
				<% @projects.each do |project| %>
				<% if (!current_user.print?)%>
				<%= render project%>
				<% else%>
				<%= render 'project_print', :project => project %>
				<% end %>
				<% end %>
			</tbody>
		</table>
		<div class="text-center">
			<%= will_paginate %>
		</div>
	</div>
</div>
